<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Deploying WordPress with CSI storage | Anthos on HPE SimpliVity</title>
    <meta name="generator" content="VuePress 1.4.1">
    
    <meta name="description" content="">
    <link rel="preload" href="/Anthos-on-SimpliVity/assets/css/0.styles.48ef4742.css" as="style"><link rel="preload" href="/Anthos-on-SimpliVity/assets/js/app.c66d36eb.js" as="script"><link rel="preload" href="/Anthos-on-SimpliVity/assets/js/3.a36c1b07.js" as="script"><link rel="preload" href="/Anthos-on-SimpliVity/assets/js/4.a503e121.js" as="script"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/10.4c6c4b11.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/11.b50dfb64.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/12.612cd5c2.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/13.d1932b90.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/14.ef5c46d5.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/15.d677261b.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/16.2a2ea771.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/17.edb6588e.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/18.d03631f1.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/19.5fd97853.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/20.8f108193.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/21.05dfe4aa.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/22.dd6e49af.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/23.27a8babf.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/24.47febf86.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/25.9be53ca1.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/26.c17a6585.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/27.8e86709c.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/28.b4210471.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/29.fc616650.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/30.70382014.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/31.8885ebe1.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/32.21d37204.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/33.1a1a0ae7.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/34.82fff274.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/35.a3010252.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/36.eac99218.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/37.79eb7584.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/38.086e225b.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/39.34bca0dc.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/40.da913a9c.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/41.5e116b73.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/42.252b76ea.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/43.f08f03ed.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/44.3e86c83e.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/45.8be5bf04.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/46.0914dd1c.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/47.e4fdd50d.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/48.edbb4d00.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/49.65c66dc0.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/5.821ad560.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/50.a84a0f7b.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/51.ae39a4c1.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/52.de121ac3.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/53.f63646fd.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/54.26356f7e.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/55.23bb6679.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/56.75c08a92.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/57.9411fbcb.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/58.56f313da.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/59.1845e68b.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/6.64279308.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/60.5573aebb.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/61.4a7cfc53.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/62.d92d1e67.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/63.50230074.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/64.e3433747.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/7.77f3198a.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/8.b921b66e.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/9.270fec6a.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/vendors~docsearch.ef9ce2b1.js">
    <link rel="stylesheet" href="/Anthos-on-SimpliVity/assets/css/0.styles.48ef4742.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Anthos-on-SimpliVity/" class="home-link router-link-active"><img src="/Anthos-on-SimpliVity/assets/images/hpe-logo-nav.jpg" alt="Anthos on HPE SimpliVity" class="logo"> <span class="site-name can-hide">Anthos on HPE SimpliVity</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Anthos-on-SimpliVity/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/Anthos-on-SimpliVity/blog/" class="nav-link">
  Blog
</a></div> <a href="https://github.com/HewlettPackard/Anthos-on-SimpliVity" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute!
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Anthos-on-SimpliVity/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/Anthos-on-SimpliVity/blog/" class="nav-link">
  Blog
</a></div> <a href="https://github.com/HewlettPackard/Anthos-on-SimpliVity" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute!
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/Anthos-on-SimpliVity/summary.html" class="sidebar-link">Executive summary</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Release Notes</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution overview</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution components</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Preparing the environment </span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Configuring the solution</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Running the playbooks</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Post deployment tasks</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Storage</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Anthos-on-SimpliVity/storage/storage-class.html" class="sidebar-link">Storage class</a></li><li><a href="/Anthos-on-SimpliVity/storage/use-csi-wordpress.html" class="active sidebar-link">Deploying WordPress with CSI storage</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Anthos-on-SimpliVity/storage/use-csi-wordpress.html#deploy-wordpress-with-mysql" class="sidebar-link">Deploy WordPress with MySQL</a></li><li class="sidebar-sub-header"><a href="/Anthos-on-SimpliVity/storage/use-csi-wordpress.html#accessing-the-wordpress-service" class="sidebar-link">Accessing the WordPress service</a></li><li class="sidebar-sub-header"><a href="/Anthos-on-SimpliVity/storage/use-csi-wordpress.html#exploring-wordpress-content" class="sidebar-link">Exploring WordPress content</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Service Mesh</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="deploying-wordpress-with-csi-storage"><a href="#deploying-wordpress-with-csi-storage" class="header-anchor">#</a> Deploying WordPress with CSI storage</h1> <p>WordPress uses a database to store posts and comments, while it stores other assets including images, CSS and
Javascript files in a separate filestore. In this example, two persistent volume claims (PVCs) are deployed using
the HPE SimpliVity CSI Driver, one for the MySQL datadase and the other for the WordPress filestore.</p> <h2 id="deploy-wordpress-with-mysql"><a href="#deploy-wordpress-with-mysql" class="header-anchor">#</a> Deploy WordPress with MySQL</h2> <p>To deploy WordPress with MySQL on a user cluster, you will need to:</p> <ul><li>Connect to the admin workstation</li> <li>Configure access to the user cluster</li> <li>Use manifest files to deploy the required resources</li></ul> <h3 id="connect-to-your-admin-workstation"><a href="#connect-to-your-admin-workstation" class="header-anchor">#</a> Connect to your admin workstation</h3> <p>Connect to your admin workstation, using the appropriate IP address:</p> <div class="language- extra-class"><pre class="language-text"><code>ssh -i /root/anthos_secrets/vsphere_workstation ubuntu@10.15.155.200
</code></pre></div><h3 id="configure-kubeconfig"><a href="#configure-kubeconfig" class="header-anchor">#</a> Configure KUBECONFIG</h3> <p>Configure KUBECONFIG, using the appropriate user cluster name, for example:</p> <div class="language- extra-class"><pre class="language-text"><code>export KUBECONFIG=~/kubeconfigs/gmcg-gke-usercluster-1-kubeconfig
</code></pre></div><h3 id="create-namespace"><a href="#create-namespace" class="header-anchor">#</a> Create namespace</h3> <p>Create a file named <code>wordpress-mysql-namespace.yml</code> with the following content:</p> <div class="language- extra-class"><pre class="language-text"><code>apiVersion: v1
kind: Namespace
metadata:
  name:  'wordpress-mysql'
</code></pre></div><p>Create the namespace:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl apply -f wordpress-mysql-namespace.yml

namespace/wordpress-mysql created
</code></pre></div><h3 id="create-secret-for-mysql"><a href="#create-secret-for-mysql" class="header-anchor">#</a> Create secret for MySQL</h3> <p>Create a file named <code>mysql-password.yml</code> with the following content:</p> <div class="language- extra-class"><pre class="language-text"><code>apiVersion: v1
data:
  password: cGFzc3dvcmQ=
kind: Secret
metadata:
  name: mysql-pass
  namespace: wordpress-mysql
</code></pre></div><p>Create the secret:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl -n wordpress-mysql  apply -f secret-password.yml

secret/mysql-pass created
</code></pre></div><h3 id="create-pvc-for-mysql"><a href="#create-pvc-for-mysql" class="header-anchor">#</a> Create PVC for MySQL</h3> <p>Create a file named <code>mysql-pvc.yml</code> with the following content, updating the storage class with your CSI storage class for the user cluster:</p> <div class="language- extra-class"><pre class="language-text"><code>apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: mysql-pv-claim
  labels:
    app: wordpress
  annotations:
    volume.beta.kubernetes.io/storage-class: 'gmcg-vmware-sc'
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 1Gi
</code></pre></div><p>Create the PVC for MySQL:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl -n wordpress-mysql apply -f mysql-pvc.yml

persistentvolumeclaim/mysql-pv-claim created
</code></pre></div><p>Inspect the volume claim - it will initially be in the <code>pending</code> state:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl -n wordpress-mysql get pvc

NAME             STATUS    VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS      AGE
mysql-pv-claim   Pending                                      gmcg-vmware-sc    10s
</code></pre></div><p>Wait until the PVC has been created:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl -n wordpress-mysql get pvc

NAME             STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS      AGE
mysql-pv-claim   Bound    pvc-ecc09402-75f3-477a-af75-15f87cd2c6a8   1Gi        RWO            gmcg-vmware-sc    53s
</code></pre></div><p>Examine the corresponding PV:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl -n wordpress-mysql get pv

NAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                        STORAGECLASS   REASON   AGE

pvc-ecc09402-75f3-477a-af75-15f87cd2c6a8   1Gi        RWO            Delete           Bound    wordpress-mysql/mysql-pv-claim               gmcg-vmware-sc             16s
</code></pre></div><h3 id="create-service-for-mysql"><a href="#create-service-for-mysql" class="header-anchor">#</a> Create service for MySQL</h3> <p>Create a file named <code>mysql-service.yml</code> with the following content:</p> <div class="language- extra-class"><pre class="language-text"><code>apiVersion: v1
kind: Service
metadata:
  name: wordpress-mysql
  labels:
    app: wordpress
spec:
  ports:
    - port: 3306
  selector:
    app: wordpress
    tier: mysql
  clusterIP: None
</code></pre></div><p>Deploy the service:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl -n wordpress-mysql  apply -f mysql-service.yml

service/wordpress-mysql created
</code></pre></div><p>Inspect the service:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl -n wordpress-mysql  get svc wordpress-mysql

NAME              TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)    AGE
wordpress-mysql   ClusterIP   None         &lt;none&gt;        3306/TCP   17s
</code></pre></div><h3 id="deploy-mysql"><a href="#deploy-mysql" class="header-anchor">#</a> Deploy MySQL</h3> <p>Create a file named <code>mysql-deployment.yml</code> with the following content:</p> <div class="language- extra-class"><pre class="language-text"><code>apiVersion: apps/v1
kind: Deployment
metadata:
  name: wordpress-mysql
  labels:
    app: wordpress
spec:
  selector:
    matchLabels:
      app: wordpress
      tier: mysql
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        app: wordpress
        tier: mysql
    spec:
      containers:
      - image: mysql:5.6
        name: mysql
        env:
        - name: MYSQL_ROOT_PASSWORD
          valueFrom:
            secretKeyRef:
              name: mysql-pass
              key: password
        ports:
        - containerPort: 3306
          name: mysql
        volumeMounts:
        - name: mysql-persistent-storage
          mountPath: /var/lib/mysql
      volumes:
      - name: mysql-persistent-storage
        persistentVolumeClaim:
          claimName: mysql-pv-claim
</code></pre></div><p>Deploy MySQL:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl -n wordpress-mysql apply -f mysql-deployment.yml

deployment.apps/wordpress-mysql created
</code></pre></div><p>Inspect the deployment - it may take a while for it to complete:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl -n wordpress-mysql  get deployment wordpress-mysql

NAME              READY   UP-TO-DATE   AVAILABLE   AGE
wordpress-mysql   0/1     1            0           9s
</code></pre></div><p>Wait until the deployment is ready:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl -n wordpress-mysql  get pods

NAME                              READY   STATUS    RESTARTS   AGE
wordpress-mysql-67565bd57-lvbg2   1/1     Running   0          64s
</code></pre></div><p>You can get more information on the deployment using the <code>describe deployment</code> option:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl -n wordpress-mysql describe deployment wordpress-mysql

Name:               wordpress-mysql
Namespace:          wordpress-mysql
CreationTimestamp:  Tue, 16 Jun 2020 13:27:39 +0000
Labels:             app=wordpress
Annotations:        deployment.kubernetes.io/revision: 1
                    kubectl.kubernetes.io/last-applied-configuration:
                      {&quot;apiVersion&quot;:&quot;apps/v1&quot;,&quot;kind&quot;:&quot;Deployment&quot;,&quot;metadata&quot;:{&quot;annotations&quot;:{},&quot;labels&quot;:{&quot;app&quot;:&quot;wordpress&quot;},&quot;name&quot;:&quot;wordpress-mysql&quot;,&quot;namespace&quot;...
Selector:           app=wordpress,tier=mysql
Replicas:           1 desired | 1 updated | 1 total | 1 available | 0 unavailable
StrategyType:       Recreate
MinReadySeconds:    0
Pod Template:
  Labels:  app=wordpress
           tier=mysql
  Containers:
   mysql:
    Image:      mysql:5.6
    Port:       3306/TCP
    Host Port:  0/TCP
    Environment:
      MYSQL_ROOT_PASSWORD:  &lt;set to the key 'password' in secret 'mysql-pass'&gt;  Optional: false
    Mounts:
      /var/lib/mysql from mysql-persistent-storage (rw)
  Volumes:
   mysql-persistent-storage:
    Type:       PersistentVolumeClaim (a reference to a PersistentVolumeClaim in the same namespace)
    ClaimName:  mysql-pv-claim
    ReadOnly:   false
Conditions:
  Type           Status  Reason
  ----           ------  ------
  Available      True    MinimumReplicasAvailable
  Progressing    True    NewReplicaSetAvailable
OldReplicaSets:  &lt;none&gt;
NewReplicaSet:   wordpress-mysql-67565bd57 (1/1 replicas created)
Events:
  Type    Reason             Age   From                   Message
  ----    ------             ----  ----                   -------
  Normal  ScalingReplicaSet  53s   deployment-controller  Scaled up replica set wordpress-mysql-67565bd57 to 1
</code></pre></div><h3 id="create-pvc-for-wordpress"><a href="#create-pvc-for-wordpress" class="header-anchor">#</a> Create PVC for WordPress</h3> <p>Create the file <code>wordpress-pvc.yml</code> with the following content:</p> <div class="language- extra-class"><pre class="language-text"><code>apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: wp-pv-claim
  labels:
    app: wordpress
  annotations:
    volume.beta.kubernetes.io/storage-class: 'gmcg-vmware-sc'
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 5Gi
</code></pre></div><p>Create the PVC for WordPress:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl -n wordpress-mysql apply -f wordpress-pvc.yml

persistentvolumeclaim/wp-pv-claim created
</code></pre></div><p>Inspect the volume claim - it will initially be in the <code>pending</code> state:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl -n wordpress-mysql get pvc wp-pv-claim
 
NAME             STATUS    VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS      AGE
wp-pv-claim      Pending                                                                        gmcg-vmware-sc    5s
</code></pre></div><p>Wait until the PVC has been created:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl -n wordpress-mysql  get pvc wp-pv-claim

NAME             STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS      AGE
wp-pv-claim      Bound    pvc-1363ba16-8215-442a-b094-35fdd46f535b   5Gi        RWO            gmcg-vmware-sc    9m23s
</code></pre></div><h3 id="create-service-for-mysql-2"><a href="#create-service-for-mysql-2" class="header-anchor">#</a> Create service for MySQL</h3> <p>Create a manifest named <code>wordpress-service.yml</code> with content similar to the example below. The <code>loadBalancerIP</code> in the example
is an IP address on the network configured in F5 with <code>external_vlan_name</code> set to <code>external</code>.
The IP address you choose must not already be in use and must be routable from the location of any client that sends requests to the Service.</p> <div class="language- extra-class"><pre class="language-text"><code>apiVersion: v1
kind: Service
metadata:
  name: wordpress
  labels:
    app: wordpress
spec:
  ports:
    - port: 80
  selector:
    app: wordpress
    tier: frontend
  type: LoadBalancer
  loadBalancerIP: 10.15.158.77
</code></pre></div><p>Create the MySQL service:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl -n wordpress-mysql apply -f wordpress-service.yml

service/wordpress created
</code></pre></div><p>Inspect the service:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl -n wordpress-mysql  get svc wordpress

NAME        TYPE           CLUSTER-IP      EXTERNAL-IP    PORT(S)        AGE
wordpress   LoadBalancer   10.96.162.244   10.15.158.77   80:32064/TCP   5s
</code></pre></div><p>In this scenario, a client will send a request to the <code>loadBalancerIP</code> address 10.15.158.77 on TCP port 80.
The request gets routed to your F5 BIG-IP load balancer. The load balancer chooses one of your user cluster nodes,
and forwards the request to the node address on TCP port 32064. The iptables rules on the node forward
the request to a member pod on TCP port 80. (By default, the <code>targetPort</code> is set to the same value as the <code>port</code> field).</p> <h3 id="deploy-wordpress"><a href="#deploy-wordpress" class="header-anchor">#</a> Deploy WordPress</h3> <p>Create a file named <code>wordpress-deployment.yml</code> with the following content:</p> <div class="language- extra-class"><pre class="language-text"><code>apiVersion: apps/v1 # for versions before 1.9.0 use apps/v1beta2
kind: Deployment
metadata:
  name: wordpress
  labels:
    app: wordpress
spec:
  selector:
    matchLabels:
      app: wordpress
      tier: frontend
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        app: wordpress
        tier: frontend
    spec:
      containers:
      - image: wordpress:4.8-apache
        name: wordpress
        env:
        - name: WORDPRESS_DB_HOST
          value: wordpress-mysql
        - name: WORDPRESS_DB_PASSWORD
          valueFrom:
            secretKeyRef:
              name: mysql-pass
              key: password
        ports:
        - containerPort: 80
          name: wordpress
        volumeMounts:
        - name: wordpress-persistent-storage
          mountPath: /var/www/html
      volumes:
      - name: wordpress-persistent-storage
        persistentVolumeClaim:
          claimName: wp-pv-claim
</code></pre></div><p>Deploy WordPress:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl -n wordpress-mysql apply -f wordpress-deployment.yml

deployment.apps/wordpress created
</code></pre></div><p>Inspect the deployment:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl -n wordpress-mysql  get deployment wordpress

NAME              READY   UP-TO-DATE   AVAILABLE   AGE
wordpress         0/1     1            0           8s
</code></pre></div><p>Wait until WordPress is ready:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl -n wordpress-mysql  get deployment wordpress

NAME        READY   UP-TO-DATE   AVAILABLE   AGE
wordpress   1/1     1            1           34s
</code></pre></div><p>You can use the <code>describe deployment</code> option to obtain more information about the deployment:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl -n wordpress-mysql  describe deployment wordpress
Name:               wordpress
Namespace:          wordpress-mysql
CreationTimestamp:  Tue, 16 Jun 2020 13:59:18 +0000
Labels:             app=wordpress
Annotations:        deployment.kubernetes.io/revision: 1
                    kubectl.kubernetes.io/last-applied-configuration:
                      {&quot;apiVersion&quot;:&quot;apps/v1&quot;,&quot;kind&quot;:&quot;Deployment&quot;,&quot;metadata&quot;:{&quot;annotations&quot;:{},&quot;labels&quot;:{&quot;app&quot;:&quot;wordpress&quot;},&quot;name&quot;:&quot;wordpress&quot;,&quot;namespace&quot;:&quot;word...
Selector:           app=wordpress,tier=frontend
Replicas:           1 desired | 1 updated | 1 total | 1 available | 0 unavailable
StrategyType:       Recreate
MinReadySeconds:    0
Pod Template:
  Labels:  app=wordpress
           tier=frontend
  Containers:
   wordpress:
    Image:      wordpress:4.8-apache
    Port:       80/TCP
    Host Port:  0/TCP
    Environment:
      WORDPRESS_DB_HOST:      wordpress-mysql
      WORDPRESS_DB_PASSWORD:  &lt;set to the key 'password' in secret 'mysql-pass'&gt;  Optional: false
    Mounts:
      /var/www/html from wordpress-persistent-storage (rw)
  Volumes:
   wordpress-persistent-storage:
    Type:       PersistentVolumeClaim (a reference to a PersistentVolumeClaim in the same namespace)
    ClaimName:  wp-pv-claim
    ReadOnly:   false
Conditions:
  Type           Status  Reason
  ----           ------  ------
  Available      True    MinimumReplicasAvailable
  Progressing    True    NewReplicaSetAvailable
OldReplicaSets:  &lt;none&gt;
NewReplicaSet:   wordpress-549c4f6867 (1/1 replicas created)
Events:
  Type    Reason             Age   From                   Message
  ----    ------             ----  ----                   -------
  Normal  ScalingReplicaSet  30s   deployment-controller  Scaled up replica set wordpress-549c4f6867 to 1
</code></pre></div><h2 id="accessing-the-wordpress-service"><a href="#accessing-the-wordpress-service" class="header-anchor">#</a> Accessing the WordPress service</h2> <p>You can browse to the LoadBalancerIP, in this case 10.15.158.77 and choose your language:</p> <p><img src="/Anthos-on-SimpliVity/assets/img/wordpress-lang.b709bd52.png" alt="&quot;WordPress install&quot;"></p> <p><strong>Figure ?.</strong> WordPress language</p> <p>Fill in the details and install:</p> <p><img src="/Anthos-on-SimpliVity/assets/img/wordpress-install.afaba736.png" alt="&quot;WordPress install&quot;"></p> <p><strong>Figure ?.</strong> WordPress install</p> <p>When you log in to WordPress, you will see the admin dashboard:</p> <p><img src="/Anthos-on-SimpliVity/assets/img/wordpress-welcome.e13768fc.png" alt="&quot;WordPress admin dashboard&quot;"></p> <p><strong>Figure ?.</strong> WordPress admin dashboard</p> <p>Create a new blog post by clicking &quot;Write your first blog post&quot;:</p> <p><img src="/Anthos-on-SimpliVity/assets/img/wordpress-new-post.24cf956f.png" alt="&quot;WordPress new post&quot;"></p> <p><strong>Figure ?.</strong> WordPress new post</p> <p>Add a title and some text content, and then insert an image into your blog post by clicking on &quot;Add Media&quot;:</p> <p><img src="/Anthos-on-SimpliVity/assets/img/wordpress-new-post-done.2db6721f.png" alt="&quot;WordPress finished new post&quot;"></p> <p><strong>Figure ?.</strong> WordPress finished new post</p> <p>Click the <code>Publish</code> button to make the blog post public and then view the post:</p> <p><img src="/Anthos-on-SimpliVity/assets/img/wordpress-publish.26fd8afb.png" alt="&quot;WordPress published post&quot;"></p> <p><strong>Figure ?.</strong> WordPress published post</p> <h2 id="exploring-wordpress-content"><a href="#exploring-wordpress-content" class="header-anchor">#</a> Exploring WordPress content</h2> <p>Identify the WordPress pod, in this case, <code>wordpress-549c4f6867-7qx66</code>:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl get pods -n wordpress-mysql

NAME                              READY   STATUS    RESTARTS   AGE
wordpress-549c4f6867-7qx66        1/1     Running   0          19h
wordpress-mysql-67565bd57-lvbg2   1/1     Running   0          19h
</code></pre></div><p>Install <code>jq</code>:</p> <div class="language- extra-class"><pre class="language-text"><code>sudo apt-get install jq
</code></pre></div><p>Use a json query to identify the volume mounts:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl get pods -n wordpress-mysql wordpress-549c4f6867-7qx66 -o json | jq '.spec.containers[].volumeMounts'

[
  {
    &quot;mountPath&quot;: &quot;/var/www/html&quot;,
    &quot;name&quot;: &quot;wordpress-persistent-storage&quot;
  },
  {
    &quot;mountPath&quot;: &quot;/var/run/secrets/kubernetes.io/serviceaccount&quot;,
    &quot;name&quot;: &quot;default-token-2wqzq&quot;,
    &quot;readOnly&quot;: true
  }
]
</code></pre></div><p>Use a json query to match the volume mount with the corresponding PVC name:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl get pods -n wordpress-mysql wordpress-549c4f6867-7qx66 -o json | jq '.spec.volumes'

[
  {
    &quot;name&quot;: &quot;wordpress-persistent-storage&quot;,
    &quot;persistentVolumeClaim&quot;: {
      &quot;claimName&quot;: &quot;wp-pv-claim&quot;
    }
  },
  {
    &quot;name&quot;: &quot;default-token-2wqzq&quot;,
    &quot;secret&quot;: {
      &quot;defaultMode&quot;: 420,
      &quot;secretName&quot;: &quot;default-token-2wqzq&quot;
    }
  }
]
</code></pre></div><p>You will see that the PVC <code>wp-pv-claim</code> is mounted at <code>/var/www/html</code>. You can execute a command on the pod to list
the files:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl exec --stdin --tty -n wordpress-mysql wordpress-549c4f6867-7qx66 -- /bin/ls -l /var/www/html

-rw-r--r--  1 www-data www-data   418 Sep 25  2013 index.php
-rw-r--r--  1 www-data www-data 19935 Jun 16 15:50 license.txt
...
drwxr-xr-x  6 www-data www-data  4096 Jun 16 16:01 wp-content
...
</code></pre></div><p>If you navigate through the <code>wp-content</code> folder, you will find the files corresponding to the image you added to
the blog post:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl exec --stdin --tty -n wordpress-mysql wordpress-549c4f6867-7qx66 -- /bin/ls -l /var/www/html/wp-content/uploads/2020/06

total 124
-rw-r--r-- 1 www-data www-data  3290 Jun 16 16:01 380-with-OmniStack-100x100.jpg
-rw-r--r-- 1 www-data www-data  6183 Jun 16 16:01 380-with-OmniStack-150x150.jpg
-rw-r--r-- 1 www-data www-data  8928 Jun 16 16:01 380-with-OmniStack-300x150.jpg
-rw-r--r-- 1 www-data www-data 36764 Jun 16 16:01 380-with-OmniStack-768x384.jpg
-rw-r--r-- 1 www-data www-data 65386 Jun 16 16:01 380-with-OmniStack.jpg
</code></pre></div><p>Notice how there are multiple versions of the image, to cater for devices with different resolutions or for thumbnails.</p> <p>You can also copy the WordPress content to your local machine using the <code>kubectl cp</code> command:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl cp -n wordpress-mysql wordpress-549c4f6867-7qx66:/var/www/html  wordpress-backup-20200617
</code></pre></div><p>Once again, you can navigate down to the files corresponding to the image:</p> <div class="language- extra-class"><pre class="language-text"><code>ls -l wordpress-backup-20200617/wp-content/uploads/2020/06

total 124
-rw-rw-r-- 1 ubuntu ubuntu  3290 Jun 17 09:44 380-with-OmniStack-100x100.jpg
-rw-rw-r-- 1 ubuntu ubuntu  6183 Jun 17 09:44 380-with-OmniStack-150x150.jpg
-rw-rw-r-- 1 ubuntu ubuntu  8928 Jun 17 09:44 380-with-OmniStack-300x150.jpg
-rw-rw-r-- 1 ubuntu ubuntu 36764 Jun 17 09:44 380-with-OmniStack-768x384.jpg
-rw-rw-r-- 1 ubuntu ubuntu 65386 Jun 17 09:44 380-with-OmniStack.jpg
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/HewlettPackard/Anthos-on-SimpliVity/edit/docs-dev/docs-src/storage/use-csi-wordpress.md" target="_blank" rel="noopener noreferrer">Help us improve this page!</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Anthos-on-SimpliVity/storage/storage-class.html" class="prev">
        Storage class
      </a></span> <span class="next"><a href="/Anthos-on-SimpliVity/service-mesh/book-info.html">
        Service mesh sample application - Bookinfo
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/Anthos-on-SimpliVity/assets/js/app.c66d36eb.js" defer></script><script src="/Anthos-on-SimpliVity/assets/js/3.a36c1b07.js" defer></script><script src="/Anthos-on-SimpliVity/assets/js/4.a503e121.js" defer></script>
  </body>
</html>
