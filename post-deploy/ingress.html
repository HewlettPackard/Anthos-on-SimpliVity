<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Cluster ingress | Anthos on HPE SimpliVity</title>
    <meta name="generator" content="VuePress 1.4.1">
    
    <meta name="description" content="">
    <link rel="preload" href="/Anthos-on-SimpliVity/assets/css/0.styles.48ef4742.css" as="style"><link rel="preload" href="/Anthos-on-SimpliVity/assets/js/app.c66d36eb.js" as="script"><link rel="preload" href="/Anthos-on-SimpliVity/assets/js/3.a36c1b07.js" as="script"><link rel="preload" href="/Anthos-on-SimpliVity/assets/js/12.612cd5c2.js" as="script"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/10.4c6c4b11.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/11.b50dfb64.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/13.d1932b90.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/14.ef5c46d5.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/15.d677261b.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/16.2a2ea771.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/17.edb6588e.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/18.d03631f1.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/19.5fd97853.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/20.8f108193.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/21.05dfe4aa.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/22.dd6e49af.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/23.27a8babf.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/24.47febf86.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/25.9be53ca1.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/26.c17a6585.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/27.8e86709c.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/28.b4210471.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/29.fc616650.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/30.70382014.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/31.8885ebe1.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/32.21d37204.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/33.1a1a0ae7.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/34.82fff274.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/35.a3010252.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/36.eac99218.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/37.79eb7584.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/38.086e225b.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/39.34bca0dc.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/4.a503e121.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/40.da913a9c.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/41.5e116b73.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/42.252b76ea.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/43.f08f03ed.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/44.3e86c83e.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/45.8be5bf04.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/46.0914dd1c.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/47.e4fdd50d.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/48.edbb4d00.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/49.65c66dc0.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/5.821ad560.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/50.a84a0f7b.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/51.ae39a4c1.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/52.de121ac3.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/53.f63646fd.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/54.26356f7e.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/55.23bb6679.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/56.75c08a92.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/57.9411fbcb.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/58.56f313da.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/59.1845e68b.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/6.64279308.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/60.5573aebb.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/61.4a7cfc53.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/62.d92d1e67.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/63.50230074.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/64.e3433747.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/7.77f3198a.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/8.b921b66e.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/9.270fec6a.js"><link rel="prefetch" href="/Anthos-on-SimpliVity/assets/js/vendors~docsearch.ef9ce2b1.js">
    <link rel="stylesheet" href="/Anthos-on-SimpliVity/assets/css/0.styles.48ef4742.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Anthos-on-SimpliVity/" class="home-link router-link-active"><img src="/Anthos-on-SimpliVity/assets/images/hpe-logo-nav.jpg" alt="Anthos on HPE SimpliVity" class="logo"> <span class="site-name can-hide">Anthos on HPE SimpliVity</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Anthos-on-SimpliVity/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/Anthos-on-SimpliVity/blog/" class="nav-link">
  Blog
</a></div> <a href="https://github.com/HewlettPackard/Anthos-on-SimpliVity" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute!
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Anthos-on-SimpliVity/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/Anthos-on-SimpliVity/blog/" class="nav-link">
  Blog
</a></div> <a href="https://github.com/HewlettPackard/Anthos-on-SimpliVity" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute!
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/Anthos-on-SimpliVity/summary.html" class="sidebar-link">Executive summary</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Release Notes</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution overview</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution components</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Preparing the environment </span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Configuring the solution</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Running the playbooks</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Post deployment tasks</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Anthos-on-SimpliVity/post-deploy/connect.html" class="sidebar-link">Accessing your clusters</a></li><li><a href="/Anthos-on-SimpliVity/post-deploy/using-ssh.html" class="sidebar-link">Using SSH to connect to cluster nodes</a></li><li><a href="/Anthos-on-SimpliVity/post-deploy/cloud-console.html" class="sidebar-link">Using Cloud Console to access your user clusters</a></li><li><a href="/Anthos-on-SimpliVity/post-deploy/deploy-application.html" class="sidebar-link">Deploying an application</a></li><li><a href="/Anthos-on-SimpliVity/post-deploy/ingress.html" class="active sidebar-link">Cluster ingress</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Anthos-on-SimpliVity/post-deploy/ingress.html#connect-to-your-admin-workstation" class="sidebar-link">Connect to your admin workstation</a></li><li class="sidebar-sub-header"><a href="/Anthos-on-SimpliVity/post-deploy/ingress.html#configure-kubeconfig" class="sidebar-link">Configure KUBECONFIG</a></li><li class="sidebar-sub-header"><a href="/Anthos-on-SimpliVity/post-deploy/ingress.html#create-deployment" class="sidebar-link">Create deployment</a></li><li class="sidebar-sub-header"><a href="/Anthos-on-SimpliVity/post-deploy/ingress.html#create-a-service" class="sidebar-link">Create a service</a></li><li class="sidebar-sub-header"><a href="/Anthos-on-SimpliVity/post-deploy/ingress.html#service-details" class="sidebar-link">Service details</a></li><li class="sidebar-sub-header"><a href="/Anthos-on-SimpliVity/post-deploy/ingress.html#using-clusterip" class="sidebar-link">Using ClusterIP</a></li><li class="sidebar-sub-header"><a href="/Anthos-on-SimpliVity/post-deploy/ingress.html#using-endpoints" class="sidebar-link">Using endpoints</a></li><li class="sidebar-sub-header"><a href="/Anthos-on-SimpliVity/post-deploy/ingress.html#using-nodeport" class="sidebar-link">Using NodePort</a></li><li class="sidebar-sub-header"><a href="/Anthos-on-SimpliVity/post-deploy/ingress.html#creating-an-ingress" class="sidebar-link">Creating an Ingress</a></li></ul></li><li><a href="/Anthos-on-SimpliVity/post-deploy/resize-cluster.html" class="sidebar-link">Resizing a user cluster</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Storage</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Service Mesh</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="cluster-ingress"><a href="#cluster-ingress" class="header-anchor">#</a> Cluster ingress</h1> <p>This page describes the use of a number of methods used to enable access to cluster services including:</p> <ul><li>ClusterIP</li> <li>Service endpoints</li> <li>NodePort</li> <li>Ingress</li></ul> <p>For information on <code>LoadBalancer</code>, see the section <a href="deploy-application">Deploying an application</a>.</p> <h2 id="connect-to-your-admin-workstation"><a href="#connect-to-your-admin-workstation" class="header-anchor">#</a> Connect to your admin workstation</h2> <div class="language- extra-class"><pre class="language-text"><code>ssh -i /root/anthos_secrets/vsphere_workstation ubuntu@10.15.155.200
</code></pre></div><h2 id="configure-kubeconfig"><a href="#configure-kubeconfig" class="header-anchor">#</a> Configure KUBECONFIG</h2> <p>Configure KUBECONFIG, using the appropriate user cluster name:</p> <div class="language- extra-class"><pre class="language-text"><code>export KUBECONFIG=~/kubeconfigs/gmcg-gke-usercluster-1-kubeconfig
</code></pre></div><h2 id="create-deployment"><a href="#create-deployment" class="header-anchor">#</a> Create deployment</h2> <p>Create a manifest file named <code>hello-deployment.yaml</code> with the following content:</p> <div class="language- extra-class"><pre class="language-text"><code>apiVersion: apps/v1
kind: Deployment
metadata:
  name: hello-deployment
spec:
  selector:
    matchLabels:
      greeting: hello
  replicas: 3
  template:
    metadata:
      labels:
        greeting: hello
    spec:
      containers:
      - name: hello-world
        image: &quot;gcr.io/google-samples/hello-app:2.0&quot;
        env:
        - name: &quot;PORT&quot;
          value: &quot;50000&quot;
      - name: hello-kubernetes
        image: &quot;gcr.io/google-samples/node-hello:1.0&quot;
        env:
        - name: &quot;PORT&quot;
          value: &quot;8080&quot;
</code></pre></div><p>The deployment specifies two continers in each pod. The first container <code>hello-app</code> responds with , while the second container <code>node-hello</code> responds with .</p> <p>Create the deployment using the manifest:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl apply -f hello-deployment.yaml
</code></pre></div><h2 id="create-a-service"><a href="#create-a-service" class="header-anchor">#</a> Create a service</h2> <p>You can expose your deployment to clients outside your cluster using a Kubernetes service of type <code>NodePort</code>.
Create a manifest file named <code>hello-service.yaml</code> with the following content:</p> <div class="language- extra-class"><pre class="language-text"><code>apiVersion: v1
kind: Service
metadata:
  name: hello-service
spec:
  type: NodePort
  selector:
    greeting: hello
  ports:
  - name: world-port
    protocol: TCP
    port: 60000
    targetPort: 50000
  - name: kubernetes-port
    protocol: TCP
    port: 60001
    targetPort: 8080
</code></pre></div><p>In the preceding example <a href="deploy-application">Deploying an application</a>, the type of service was <code>LoadBalancer</code> and you
specified a <code>loadBalancerIP</code>.</p> <p>In this instance, you create a service of type <code>NodePort</code>. This opens a specific port on all the nodes in the user
cluster, and any traffic that is sent to this port is forwarded to the service. While you can explicitly set a specific
port to open on the nodes, using the <code>nodePort</code> field, it is better to allow Kubernetes to assign a random port.</p> <p>Create the service:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl apply -f hello-service.yaml
</code></pre></div><h2 id="service-details"><a href="#service-details" class="header-anchor">#</a> Service details</h2> <p>Display a summary of the service:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl get svc

NAME            TYPE           CLUSTER-IP     EXTERNAL-IP    PORT(S)                           AGE
hello-service   NodePort       10.98.60.245   &lt;none&gt;         60000:31712/TCP,60001:30536/TCP   21s
</code></pre></div><p>For more details, use <code>kubectl describe</code>:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl describe svc hello-service

Name:                     hello-service
Namespace:                default
Labels:                   &lt;none&gt;
Annotations:              kubectl.kubernetes.io/last-applied-configuration:
                            {&quot;apiVersion&quot;:&quot;v1&quot;,&quot;kind&quot;:&quot;Service&quot;,&quot;metadata&quot;:{&quot;annotations&quot;:{},&quot;name&quot;:&quot;hello-service&quot;,&quot;namespace&quot;:&quot;default&quot;},&quot;spec&quot;:{&quot;ports&quot;:[{&quot;name&quot;:&quot;w...
Selector:                 greeting=hello
Type:                     NodePort
IP:                       10.98.60.245
Port:                     world-port  60000/TCP
TargetPort:               50000/TCP
NodePort:                 world-port  31712/TCP
Endpoints:                192.168.1.10:50000,192.168.3.20:50000,192.168.4.4:50000
Port:                     kubernetes-port  60001/TCP
TargetPort:               8080/TCP
NodePort:                 kubernetes-port  30536/TCP
Endpoints:                192.168.1.10:8080,192.168.3.20:8080,192.168.4.4:8080
Session Affinity:         None
External Traffic Policy:  Cluster
Events:                   &lt;none&gt;
</code></pre></div><h2 id="using-clusterip"><a href="#using-clusterip" class="header-anchor">#</a> Using ClusterIP</h2> <p>Connect to one of your cluster nodes, as described in <a href="using-ssh">Using SSH to connect to cluster nodes</a>:</p> <div class="language- extra-class"><pre class="language-text"><code>ssh -i ~/.ssh/gmcg-gke-usercluster-1.key ubuntu@10.15.155.121
</code></pre></div><p>Access the <code>hello-app</code> container using the ClusterIP <code>10.98.60.245</code> and the <code>port</code> value <code>60000</code> set in the deployment manifest:</p> <div class="language- extra-class"><pre class="language-text"><code>curl 10.98.60.245:60000

Hello, world!
Version: 2.0.0
Hostname: hello-deployment-79d7c89847-g7cpj
</code></pre></div><p>Access the second container, <code>node-hello</code>, again using  the ClusterIP <code>10.98.60.245</code> but with <code>port</code> value <code>60001</code>:</p> <div class="language- extra-class"><pre class="language-text"><code>curl 10.98.60.245:60001

Hello Kubernetes!
</code></pre></div><h2 id="using-endpoints"><a href="#using-endpoints" class="header-anchor">#</a> Using endpoints</h2> <p>There are three endpoints for accessing each container, since the deployment specified <code>replicas: 3</code> for the number of
pods to create.</p> <p>You can access the <code>hello-app</code> container using one of the three endpoints for the port named <code>world-port</code>:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl describe svc hello-service

Name:                     hello-service
...
Port:                     world-port  60000/TCP
TargetPort:               50000/TCP
Port:                     world-port  60000/TCP
Endpoints:                192.168.1.10:50000,192.168.3.20:50000,192.168.4.4:50000
</code></pre></div><p>Connect to one of your cluster nodes using <code>ssh</code>, choose one of the endpoints using the <code>targetPort</code> of <code>50000</code> and use <code>curl</code>:</p> <div class="language- extra-class"><pre class="language-text"><code>curl 192.168.1.10:50000

Hello, world!
Version: 2.0.0
Hostname: hello-deployment-79d7c89847-g7cpj
</code></pre></div><p>You can access the second container, <code>node-hello</code> using one of the three endpoints for the port named <code>kubernetes-port</code>:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl describe svc hello-service

Name:                     hello-service
...
Port:                     kubernetes-port  60001/TCP
TargetPort:               8080/TCP
NodePort:                 kubernetes-port  30536/TCP
Endpoints:                192.168.1.10:8080,192.168.3.20:8080,192.168.4.4:8080
</code></pre></div><p>Connect to one of your cluster nodes using <code>ssh</code>, choose one of the endpoints using the <code>targetPort</code> of <code>8080</code> and use <code>curl</code>:</p> <div class="language- extra-class"><pre class="language-text"><code>curl 192.168.1.10:8080

Hello Kubernetes!
</code></pre></div><h3 id="alternative-to-using-ssh-for-curl"><a href="#alternative-to-using-ssh-for-curl" class="header-anchor">#</a> Alternative to using ssh for curl</h3> <p>Instead of using SSH to access the user cluster, you could deploy an image using <code>kubectl</code> on the admin workstation:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl run curl --image=radial/busyboxplus:curl -i --tty
</code></pre></div><p>You can then test access to the containers using either the ClusterIP with the <code>port</code> or the endpoints with the <code>targetPort</code>, for example:</p> <div class="language- extra-class"><pre class="language-text"><code>[ root@curl-6bf6db5c4f-qc7t4:/ ]$ curl 10.98.60.245:60000

Hello, world!
Version: 2.0.0
Hostname: hello-deployment-79d7c89847-m7lzr
</code></pre></div><h2 id="using-nodeport"><a href="#using-nodeport" class="header-anchor">#</a> Using NodePort</h2> <p>A service of type <code>NodePort</code> opens a specific port on all the nodes in the user
cluster, and any traffic that is sent to this port is forwarded to the service.</p> <p>Determine the addresses of the nodes in your user cluster, using the <code>-o wide</code> option:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl get nodes -o wide

NAME                   STATUS   ROLES    AGE     VERSION          INTERNAL-IP     EXTERNAL-IP     OS-IMAGE             KERNEL-VERSION     CONTAINER-RUNTIME
gmcg-gke-user1-node1   Ready    &lt;none&gt;   7d18h   v1.16.8-gke.6   10.15.155.121   10.15.155.121   Ubuntu 18.04.4 LTS   5.3.0-53-generic   docker://19.3.2
gmcg-gke-user1-node2   Ready    &lt;none&gt;   7d18h   v1.16.8-gke.6   10.15.155.122   10.15.155.122   Ubuntu 18.04.4 LTS   5.3.0-53-generic   docker://19.3.2
gmcg-gke-user1-node3   Ready    &lt;none&gt;   7d18h   v1.16.8-gke.6   10.15.155.123   10.15.155.123   Ubuntu 18.04.4 LTS   5.3.0-53-generic   docker://19.3.2
gmcg-gke-user1-node4   Ready    &lt;none&gt;   7d18h   v1.16.8-gke.6   10.15.155.124   10.15.155.124   Ubuntu 18.04.4 LTS   5.3.0-53-generic   docker://19.3.2
gmcg-gke-user1-node5   Ready    &lt;none&gt;   2d21h   v1.16.8-gke.6   10.15.155.125   10.15.155.125   Ubuntu 18.04.4 LTS   5.3.0-53-generic   docker://19.3.2
</code></pre></div><p>Use the <code>nodePort</code> for the <code>hello-world</code> container with the IP address of a node in your user cluster:</p> <div class="language- extra-class"><pre class="language-text"><code>curl 10.15.155.121:31712

Hello, world!
Version: 2.0.0
Hostname: hello-deployment-79d7c89847-g7cpj
</code></pre></div><p>Similarly, use the <code>nodePort</code> for the <code>node-hello</code> container with the IP address of a node in your user cluster:</p> <div class="language- extra-class"><pre class="language-text"><code>curl 10.15.155.121:30536

Hello Kubernetes!
</code></pre></div><h2 id="creating-an-ingress"><a href="#creating-an-ingress" class="header-anchor">#</a> Creating an Ingress</h2> <p>As part of creating your user cluster, you specified a virtual IP address (VIP) for ingress by providing a value for <code>gke_cluster_config.cluster_ingress_vip</code> for each cluster in your configuration file.</p> <p>When a client sends a request to your user cluster ingress VIP, the request is routed to your F5 BIG-IP load balancer. The load balancer forwards the request to an ingress Service running in your user cluster. The ingress Service is configured to forward the request to different backends depending on the path in the request URL.</p> <p>It is important to understand that there are two different Services related to the steps in this topic:</p> <ul><li>Your Service named <code>hello-service</code>. This is a Service that you created to expose the Pods of your <code>hello-deployment</code> Deployment.</li> <li>The ingress Service that runs in the <code>gke-system</code> namespace of your user cluster. This Service is part of your cluster infrastructure.</li></ul> <h3 id="enabling-ingress"><a href="#enabling-ingress" class="header-anchor">#</a> Enabling Ingress</h3> <p>You must first enable Ingress on your Anthos GKE on-prem user cluster. For more information see the documentation at
<a href="https://cloud.google.com/anthos/gke/docs/on-prem/how-to/enable-ingress" target="_blank" rel="noopener noreferrer">https://cloud.google.com/anthos/gke/docs/on-prem/how-to/enable-ingress<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>For this example, you can create a file called <code>ingress-gateway.yaml</code>:</p> <div class="language- extra-class"><pre class="language-text"><code>apiVersion: networking.istio.io/v1alpha3
kind: Gateway
metadata:
  name: istio-autogenerated-k8s-ingress
  namespace: gke-system
spec:
  selector:
    istio: ingress-gke-system
  servers:
  - port:
      number: 80
      protocol: HTTP2
      name: http
    hosts:
    - &quot;*&quot;
</code></pre></div><p>Create this Gateway:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl apply -f ingress-gateway.yaml
</code></pre></div><p>You should now see in your F5 web console, that the virtual server for <code>gke-system_istio-ingress-80-tcp</code> is now enabled:</p> <p><img src="/Anthos-on-SimpliVity/assets/img/ingress-virtual-service.dae8174b.png" alt="&quot;Ingress virtual service&quot;"></p> <p><strong>Figure.</strong> Ingress virtual service</p> <h3 id="using-ingress"><a href="#using-ingress" class="header-anchor">#</a> Using Ingress</h3> <p>Create a manifest named <code>my-ingress.yaml</code> with the content below:</p> <div class="language- extra-class"><pre class="language-text"><code>apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: my-ingress
spec:
  rules:
  - http:
      paths:
      - path: /greet-the-world
        backend:
          serviceName: hello-service
          servicePort: 60000
      - path: /greet-kubernetes
        backend:
          serviceName: hello-service
          servicePort: 60001
</code></pre></div><p>Deploy the Ingress service:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl apply -f my-ingress.yaml
</code></pre></div><p>The Ingress resource maps the path <code>/greet-the-world</code> to <code>port:60000</code> in the Service you created earlier. Using
the ingress VIP on the external network and the path <code>/greet-the-world</code>, you will access the <code>hello-world</code> container:</p> <div class="language- extra-class"><pre class="language-text"><code>curl 10.15.158.64/greet-the-world

Hello, world!
Version: 2.0.0
Hostname: hello-deployment-79d7c89847-h6q4z
</code></pre></div><p>The Ingress resource maps the path <code>/greet-kubernetes</code> to <code>port:60000</code> in the Service that you created earlier. Using
the ingress VIP on the external network and the path <code>/greet-kubernetes</code>, you will access the <code>node-hello</code> container:</p> <div class="language- extra-class"><pre class="language-text"><code>curl 10.15.158.64/greet-kubernetes

Hello Kubernetes!
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/HewlettPackard/Anthos-on-SimpliVity/edit/docs-dev/docs-src/post-deploy/ingress.md" target="_blank" rel="noopener noreferrer">Help us improve this page!</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Anthos-on-SimpliVity/post-deploy/deploy-application.html" class="prev">
        Deploying an application
      </a></span> <span class="next"><a href="/Anthos-on-SimpliVity/post-deploy/resize-cluster.html">
        Resizing a user cluster
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/Anthos-on-SimpliVity/assets/js/app.c66d36eb.js" defer></script><script src="/Anthos-on-SimpliVity/assets/js/3.a36c1b07.js" defer></script><script src="/Anthos-on-SimpliVity/assets/js/12.612cd5c2.js" defer></script>
  </body>
</html>
