(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{419:function(e,s,t){"use strict";t.r(s);var a=t(35),n=Object(a.a)({},(function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"resizing-a-user-cluster"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#resizing-a-user-cluster"}},[e._v("#")]),e._v(" Resizing a user cluster")]),e._v(" "),t("p",[e._v("This page shows you how to add a new node to an existing user cluster that uses static IPs. For more information, see  the Google documentation at\n"),t("a",{attrs:{href:"https://cloud.google.com/anthos/gke/docs/on-prem/how-to/resizing-a-user-cluster",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://cloud.google.com/anthos/gke/docs/on-prem/how-to/resizing-a-user-cluster"),t("OutboundLink")],1),e._v(".")]),e._v(" "),t("h2",{attrs:{id:"configure-kubectl-for-the-admin-cluster"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#configure-kubectl-for-the-admin-cluster"}},[e._v("#")]),e._v(" Configure "),t("code",[e._v("kubectl")]),e._v(" for the admin cluster")]),e._v(" "),t("p",[e._v("Configure "),t("code",[e._v("kubectl")]),e._v(" to access the admin cluster. For example:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("export KUBECONFIG=~/kubeconfigs/kubeconfig\n")])])]),t("h2",{attrs:{id:"determine-the-namespace-for-the-user-cluster"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#determine-the-namespace-for-the-user-cluster"}},[e._v("#")]),e._v(" Determine the namespace for the user cluster")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kubectl get namespaces\n\nNAME                     STATUS   AGE\ndefault                  Active   4d18h\ngke-system               Active   4d18h\ngmcg-gke-usercluster-1   Active   4d18h\nkube-node-lease          Active   4d18h\nkube-public              Active   4d18h\nkube-system              Active   4d18h\n")])])]),t("h2",{attrs:{id:"view-the-reserved-addresses"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#view-the-reserved-addresses"}},[e._v("#")]),e._v(" View the reserved addresses")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kubectl get clusters -n gmcg-gke-usercluster-1  gmcg-gke-usercluster-1 -o yaml\n\napiVersion: cluster.k8s.io/v1alpha1\nkind: Cluster\nmetadata:\n...\n  name: gmcg-gke-usercluster-1\n  namespace: gmcg-gke-usercluster-1\n...\nspec:\n  clusterNetwork:\n    pods:\n      cidrBlocks:\n      - 192.168.0.0/16\n    serviceDomain: cluster.local\n    services:\n      cidrBlocks:\n      - 10.96.0.0/12\n  providerSpec:\n    value:\n      apiVersion: vsphereproviderconfig.k8s.io/v1alpha1\n      controlPlaneReplicas: 1\n      controlPlaneVersion: 1.15.7-gke.32\n      kind: VsphereClusterProviderConfig\n      loadBalancerIP: 10.15.158.63\n      loadBalancerNodePort: 0\n      metadata:\n        creationTimestamp: null\n      networkSpec:\n        dns:\n        - 10.10.173.1\n        ntp: 10.12.2.1\n        reservedAddresses:\n        - gateway: 10.15.155.1\n          hostname: gmcg-gke-user1-node1\n          ip: 10.15.155.121\n          netmask: 24\n        - gateway: 10.15.155.1\n          hostname: gmcg-gke-user1-node2\n          ip: 10.15.155.122\n          netmask: 24\n        - gateway: 10.15.155.1\n          hostname: gmcg-gke-user1-node3\n          ip: 10.15.155.123\n          netmask: 24\n        - gateway: 10.15.155.1\n          hostname: gmcg-gke-user1-node4\n          ip: 10.15.155.124\n          netmask: 24\n        searchdomains:\n        - am2.cloudra.local, gmcggke.org\n...\n")])])]),t("p",[e._v("In the command's output, look for the "),t("code",[e._v("reservedAddresses")]),e._v(" field. In this example, there are four reserved addresses for the four existing nodes in the cluster.")]),e._v(" "),t("p",[e._v("There should be more IP addresses in the field than there are nodes running in the user cluster.\nIf you need to add more addresses to the "),t("code",[e._v("reservedAddresses")]),e._v(" field, perform the following steps.")]),e._v(" "),t("h2",{attrs:{id:"edit-the-cluster-resource"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#edit-the-cluster-resource"}},[e._v("#")]),e._v(" Edit the cluster resource")]),e._v(" "),t("p",[e._v("Edit the custer resource to add as many additional static IP blocks as required. An IP block is composed of\n"),t("code",[e._v("gateway")]),e._v(", "),t("code",[e._v("hostname")]),e._v(", "),t("code",[e._v("ip")]),e._v(", and "),t("code",[e._v("netmask")]),e._v(" fields.")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kubectl edit clusters -n gmcg-gke-usercluster-1  gmcg-gke-usercluster-1\n")])])]),t("p",[e._v("In this example, two new addresses are added to the "),t("code",[e._v("reservedAddresses")]),e._v(":")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("        - gateway: 10.15.155.1\n          hostname: gmcg-gke-user1-node5\n          ip: 10.15.155.125\n          netmask: 24\n        - gateway: 10.15.155.1\n          hostname: gmcg-gke-user1-node6\n          ip: 10.15.155.126\n          netmask: 24\n")])])]),t("h2",{attrs:{id:"adding-a-node-to-the-user-cluster"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#adding-a-node-to-the-user-cluster"}},[e._v("#")]),e._v(" Adding a node to the user cluster")]),e._v(" "),t("p",[e._v("Configure "),t("code",[e._v("kubectl")]),e._v(" to access the appropriate user cluster. For example:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("export KUBECONFIG=~/kubeconfigs/gmcg-gke-usercluster-1-kubeconfig\n")])])]),t("p",[e._v("List the existing nodes in the cluster:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kubectl get nodes\n\nNAME                   STATUS   ROLES    AGE     VERSION\ngmcg-gke-user1-node1   Ready    <none>   4d21h   v1.16.8-gke.6\ngmcg-gke-user1-node2   Ready    <none>   4d21h   v1.16.8-gke.6\ngmcg-gke-user1-node3   Ready    <none>   4d21h   v1.16.8-gke.6\ngmcg-gke-user1-node4   Ready    <none>   4d21h   v1.16.8-gke.6\n")])])]),t("p",[e._v("Determine the machine deployment for the user cluster:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kubectl get machinedeployments\n\nNAME                     AGE\ngmcg-gke-usercluster-1   4d21h\n")])])]),t("p",[e._v("Get the details for the machine deployment:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kubectl get machinedeployments gmcg-gke-usercluster-1 -o yaml  \n\napiVersion: v1\nitems:\n- apiVersion: cluster.k8s.io/v1alpha1\n  kind: MachineDeployment\n  metadata:\n...\n    name: gmcg-gke-usercluster-1\n    namespace: default\n...\n  spec:\n    minReadySeconds: 0\n    progressDeadlineSeconds: 600\n    replicas: 4\n    revisionHistoryLimit: 1\n...\n")])])]),t("p",[e._v("To resize the user cluster, you need to patch the cluster's MachineDeployment configuration. You change the value of the\nconfiguration's replicas field, which indicates how many nodes the cluster should run. In this example, the existing\nvalue "),t("code",[e._v("replicas: 4")]),e._v(" is changed to "),t("code",[e._v("replicas: 5")]),e._v(" to add one extra node.")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('kubectl patch machinedeployment gmcg-gke-usercluster-1 -p "{\\"spec\\": {\\"replicas\\": 5 }}" --type=merge\n')])])]),t("h2",{attrs:{id:"verify-cluster-resizing"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#verify-cluster-resizing"}},[e._v("#")]),e._v(" Verify cluster resizing")]),e._v(" "),t("p",[e._v("After a while, the extra node will show up using the "),t("code",[e._v("kubectl get nodes")]),e._v(" command:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kubectl get nodes\n\nNAME                   STATUS   ROLES    AGE     VERSION\ngmcg-gke-user1-node1   Ready    <none>   4d21h   v1.16.8-gke.6\ngmcg-gke-user1-node2   Ready    <none>   4d21h   v1.16.8-gke.6\ngmcg-gke-user1-node3   Ready    <none>   4d21h   v1.16.8-gke.6\ngmcg-gke-user1-node4   Ready    <none>   4d21h   v1.16.8-gke.6\ngmcg-gke-user1-node5   Ready    <none>   95s     v1.16.8-gke.6\n")])])]),t("p",[e._v("Use the machine deployment resouce to verify the change:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kubectl get machinedeployments -o yaml | grep Replicas\n\n    availableReplicas: 5\n    readyReplicas: 5\n    updatedReplicas: 5\n")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);